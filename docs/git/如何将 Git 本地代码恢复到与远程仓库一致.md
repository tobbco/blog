---
title: 如何将 Git 本地代码恢复到与远程仓库一致
createTime: 2025/02/16
tags:
  - git
  - 恢复
  - reset
---

在 `Git` 使用过程中，有时我们会在本地修改代码，但最终决定放弃这些变更，恢复到与远程仓库一致的状态。本文将详细介绍如何通过 `Git` 命令实现这一目标，并确保操作的安全性。

## 前置条件

-  `Git` 2.23+
- 你已经有一个克隆好的本地 `Git` 仓库。
- 你有权限访问远程仓库（例如 `origin`）。
- 本地代码有未提交的修改（可能是未暂存或已暂存）。

## 操作步骤

### 1. 检查当前状态（可选）

在操作之前，建议先查看本地仓库的当前状态，了解有哪些修改：
```bash
git status
````
这会列出：
- 未暂存的修改（working directory changes）
- 已暂存但未提交的更改（staged changes）

### 2.放弃本地未提交的修改

如果本地有一些未提交的更改，可以通过以下命令丢弃它们：

**放弃未暂存的修改**
```bash
git restore .
```

**放弃已暂存的更改**

对于已暂存（通过 git add 添加但未提交）的更改，运行：

```bash
git restore --staged .
```

经过这两步，本地会恢复到最近一次提交的状态。

### 3.与远程仓库同步

接下来，确保本地分支与远程分支完全一致。

**确认当前分支**
```bash
git branch
```

**如分支不正确，切换分支**
```bash
git checkout <branch-name>
```

**拉取远程最新状态并覆盖本地**
```bash
git fetch origin
git reset --hard origin/<branch-name>
```
- `git fetch`：获取远程仓库的最新数据。
- `git reset --hard`：将本地分支重置为远程分支的状态。

### 4.清理未跟踪的文件（可选）

如果本地还有未跟踪的文件（比如新创建但未 git add 的文件或目录），可以通过以下命令清理：
```bash
git clean -fd
```
- -f：强制执行。
- -d：删除未跟踪的目录。

## 示例

假设你在 main 分支，想与 origin/main 保持一致，可以运行：

```bash
git fetch origin
git reset --hard origin/main
git clean -fd
```
完成后，本地仓库将与远程 origin/main 完全一致。

## 注意事项

###  数据丢失风险  

上述操作会永久丢弃本地未提交的更改。如果这些修改可能有价值，建议先备份（比如复制到其他文件夹）。
### 远程优先  

操作以远程仓库为准，请确保远程分支的状态是你期望的。
### 版本兼容性  

本文提到的 `git restore` 命令适用于` Git 2.23+`。如果使用旧版 `Git`，可以参考对应的替代命令。
   
## 总结

通过 `git restore`、`git reset --hard` 和 `git clean`，我们可以轻松地将本地仓库恢复到与远程一致的状态。这一流程在需要清理本地环境、同步团队代码时非常实用。希望这篇指南对你有所帮助！

如果有其他 Git 相关问题，欢迎留言讨论！